services:
  etl:
    image: ${BENTO_ETL_IMAGE}:${BENTO_ETL_VERSION}
    container_name: ${BENTO_ETL_CONTAINER_NAME}
    networks:
      - etl-net
    expose:
      - ${BENTO_ETL_INTERNAL_PORT}
    environment:
      - BENTO_UID
      - BENTO_DEBUG=False
      - BENTO_AUTHZ_ENABLED=True
      - BENTO_AUTHZ_SERVICE_URL
      - CORS_ORIGINS=${BENTO_CORS_ORIGINS}
      - KATSU_URL=${BENTO_KATSU_URL}/
      - SERVICE_URL_BASE_PATH=${BENTOV2_PUBLIC_URL}/api/etl
      - BENTO_OPENID_CONFIG_URL
      - ETL_CLIENT_ID=${BENTO_ETL_CLIENT_ID}
      - ETL_CLIENT_SECRET=${BENTO_ETL_CLIENT_SECRET}
    healthcheck:
      test: [ "CMD", "curl", "http://localhost:${BENTO_ETL_INTERNAL_PORT}/service-info" ]
      timeout: ${BENTO_HEALTHCHECK_TIMEOUT}
      interval: ${BENTO_HEALTHCHECK_INTERVAL}
      start_period: ${BENTO_HEALTHCHECK_START_PERIOD}
      start_interval: ${BENTO_HEALTHCHECK_START_INTERVAL}

networks:
  etl-net:
    external: true
    name: ${BENTO_ETL_NETWORK}