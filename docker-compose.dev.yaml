version: '3.7'

services:
  web:
    build:
      args:
        BENTO_WEB_IS_DEBUG: "true"
        BENTO_WEB_USER: ${CURRENT_UID}
    volumes:
      - ./lib/web/bento_web:/web/bento_web
    # Execute npm build/install and watch, and 
    # nginx "listener" upon container startup
    entrypoint: sh /web/dev_startup.sh
    extends:
      file: docker-compose.yaml
      service: web

  variant:
    build:
      context: $PWD/lib/variant
      dockerfile: Dockerfile.dev
    extends:
      file: docker-compose.yaml
      service: variant

  gateway:
    # Override network aliases, adding BENTOV2_AUTH_DOMAIN
    networks: 
        bridge-net:
          aliases:
            - ${BENTOV2_DOMAIN}
            - ${BENTOV2_AUTH_DOMAIN}
    extends:
      file: docker-compose.yaml
      service: gateway
networks: 
  bridge-net:
    external: true